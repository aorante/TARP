/* ========================================================================== */
/*   The Alan Randoms Project v0.94b                                           */
/*   tarp.c                                                                   */
/*   by mvac7/303bcn 2020                                                     */
/*   eXperimental Sound miniCompo (XSmC)                                      */
/*   Description:                                                             */
/*     Random music maker                                                     */
/* ========================================================================== */

    // Tareas para una futura version: 
    // 1)usar envolvente por soft para percusion. 
    // 2)Añadir editor de instrumentos.
    // 3) probar con SCC
    // crear sistema de envolventes por soft


//__sfr __at 0xA8 g_slotPort;
#include "../include/msxSystemVars.h"
#include "../include/msxBIOS.h"
#include "../include/newTypes.h"
#include "../include/VDP_TMS9918.h"
#include "../include/VDP_sprites.h"
#include "../include/AY38910.h"
#include "../include/joystick.h"
#include "../include/keyboard.h"
#include "../include/memory.h"

#define  HALT __asm halt __endasm

#define  SEED         0xE000
#define  PLAY_HARDW   0xE010  //(1B) indica por que chip ha de sonar (0=PSG interno;1=PSG MFR;2=SCC)
#define  PSG_RAM      0xE011  //(12B) buffer regs PSG R0-R10 
  
#define  SEQVIEWER1LINE 0x1ACE
#define  SEQVIEWER2LINE 0x1AEE


typedef struct {

  boolean isTone;
  boolean isNoise;
  uint Tone;
  char Noise;
  char Shape;
  uint Period;
    
} INST_PERC;


typedef struct {

  boolean isLoop;
  char ampValues[16];
  //char length;
    
} Envelope;


void logoScreen();
void WorkWin();

void setTileset();
void setSprites();
void setMainScr();

void showLogoScreen();

void setMSX2Palette();
void setMSX2logoPal();

void showEnv(char value);
void showSpeaker(uint vaddr, boolean value);
void switcher(uint vaddr, boolean value);

void invertDrumChannel();
void invertToneChannel();
void setChannelsState(boolean state);

void CopyPrevPatterns();
void RestorePrevPatterns();

void genDrumPattern();
void genTonePattern();

void upNotePattern();
void downNotePattern();
int getFreq(char value);
void upOctave();
void downOctave();
void showOctave();

void checkMSX();

char Rnd(char value);

void play();
void setChannelRAM(char NumChannel, boolean isTone, boolean isNoise);

uint GetVAddressByPosition(char column, char line);
void VPrintNumber(char posx, char posy, uint aNumber, char aLength);
void num2Dec16(uint aNumber, char *address);




// definicion variables globales <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
const char soft[] = "THE ALAN RANDOMS PROJECT"; 
const char author[] = "MVAC7/303BCN";
const char version[] = "0.94b";


const char enve_data[128]={
14,13,12,11,10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0,  
 0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,14,  
14,12,10, 8, 6, 4, 2, 1, 0, 1, 2, 4, 6, 8,10,12,  
 0, 1, 2, 4, 6, 8,10,12,14,12,10, 8, 6, 4, 2, 1,  
14,14,14,14,14,14,14,14, 4, 4, 4, 4, 4, 4, 4, 4, 
 7, 9,12,13,13,13,11, 8, 5, 2, 0, 0, 0, 1, 4, 6, 
14,13,13,12,11,10, 9, 8, 6, 5, 3, 2, 1, 0, 0, 0, 
14,13,12,11,10, 9, 9, 9, 9, 9, 9, 9, 8, 6, 4, 2
};

const char enve_loop[8]={false,false,true,true,false,false,false,false};



const char drumcolor[4]={4,12,8,7};

const uint vaddr_cursor[9]={0x1841,0x1901,0x19A1,0x19C1,0x1A01,0x1A21,0x1A41,0x1A81,0x1AA1};

const char yvalues[64]={
  72,65,59,53,47,41,35,30,26,21,18,15,12,10,8,8,
  8,8,9,11,13,16,20,24,28,33,38,44,50,56,62,68,
  75,81,87,93,99,105,110,115,119,123,127,130,132,134,135,135,
  135,135,133,131,128,125,122,117,113,108,102,96,90,84,78,72
};   //sin 8,136     



const char xvalues[64]={
     96,96,97,98,101,103,107,110,115,120,125,130,136,142,148,155,
     161,167,174,180,186,192,197,202,206,211,214,217,220,222,223,223,
     223,223,222,220,217,214,211,206,202,197,192,186,180,174,167,161,
     155,148,142,136,130,125,120,115,110,107,103,101,98,97,96,96
};   //cos 96,224     


char VDP_type;
boolean _isTone=false; //_ToneEnabled
boolean _DrumEnabled=false; //_DrumEnabled

char _octave;

char drum_pattern[16];
char tone_pattern[16]; //={46,0,49,0,50,0,51,0,46,0,49,0,50,0,51,0};

char prev_drum_pattern[16];  // #9
char prev_tone_pattern[16];

Envelope env_list[8];



void main(void) {

  checkMSX();
  
  COLOR(15,1,1);  
  SCREEN(2);  
  
  
  POKE(CLIKSW,0);
  
  logoScreen();
  
  HALT;
  FillVRAM(BASE10, 768, 32); //clear screen
    
    
  WorkWin();
}




void logoScreen()
{
  int timec = 700;
  
  SetSpritesSize(1);
  //SetSpritesZoom(false);
   
  showLogoScreen();  
  
  PUTSPRITE(0,74,58,12,0);
  PUTSPRITE(1,73,74,12,1);    
  PUTSPRITE(2,96,57,12,2);     
  PUTSPRITE(3,95,73,12,3);
  PUTSPRITE(4,80,64,2,4);
  PUTSPRITE(5,102,62,2,4);
 
  
  if (VDP_type>0) setMSX2logoPal();  
  
  while(timec-->0)
  {
    HALT;
    if (!(GetKeyMatrix(7)&Bit2)) break; // ESC
    if (!(GetKeyMatrix(7)&Bit7)) break; // RETURN
    if (!(GetKeyMatrix(8)&Bit0)) break; // SPACE 
    if (STRIG(1)>0 || STRIG(2)>0) break; //button 1, joy A & B    
  }

  return;
}




void WorkWin()
{
    boolean isCasio=false;
    boolean isAB=true;
    
    // key press control
    boolean keyB0pressed=false;
    boolean keyB2pressed=false;
    boolean keyB6pressed=false;
    boolean keyB7pressed=false;
    boolean keyB8pressed=false;
    //
    
    boolean joybool = false;
    
      
    //uint t;
    uint freqA;
    uint freqB;
    
    
    char amp;
    char stone_step=0; //de 31
    char sdrum_step=31;
    char sdrum_size=0;
    char sdrum_color=15;
    char variacion=0;
        
    char B_offset =3;
    
    char Tempo = 4;
    char tempoStep =4;
    char pattern_step=0;
    char ENDstep = 15;  //to control the size of the pattern
    char newENDstep = 15;
    char last_step=0;    //to delete the last cursor position

    
    char drum_type;
    char tone_note;
        
    char env_selected=0;
    char env_speed=1;    
    char env_step=0;
    
    signed char cursor_pos=0;
    
    char i,o;
    char conta=0;
    
    char keyPressed;
    
    char joyval;
    
    //char pattern[16]={1,0,3,3,0,0,3,3,1,0,3,3,0,0,3,3}; 
    //char pattern[16]={1,0,3,0,2,0,2,0,1,0,3,0,2,0,3,0}; //rock1
    
    INST_PERC Percu_casio[3];
    INST_PERC Percu_basic[3];
    
    INST_PERC *tmp_INST;
    
    ClearSprites();
    SetSpritesSize(1);    //16x16
    SetSpritesZoom(true); //zoom
    
    setSprites();
    
    // erase sprites 2 & 3  ???
    //SetSpritePattern(2,31);
    //SetSpritePattern(3,31);
  
    setTileset();
  
    if (VDP_type>0) setMSX2Palette();
    
    setMainScr();
    
    
    _octave=2;
     
    // Instrumentos percusion - Kit Casio PT1
    // Kick
    Percu_casio[0].isTone=true;
    Percu_casio[0].isNoise=false;
    Percu_casio[0].Tone=140;
    Percu_casio[0].Noise=0;
    Percu_casio[0].Shape=1;
    Percu_casio[0].Period=800;
    
    // Snare
    Percu_casio[1].isTone=false;
    Percu_casio[1].isNoise=true;
    Percu_casio[1].Tone=0;
    Percu_casio[1].Noise=0;
    Percu_casio[1].Shape=1;
    Percu_casio[1].Period=1600;
    
    // Hi
    Percu_casio[2].isTone=true;
    Percu_casio[2].isNoise=false;
    Percu_casio[2].Tone=66;
    Percu_casio[2].Noise=0;
    Percu_casio[2].Shape=1;
    Percu_casio[2].Period=400;
    
    
    // Instrumentos percusion Kit Basico
    // Kick
    Percu_basic[0].isTone=true;
    Percu_basic[0].isNoise=false;
    Percu_basic[0].Tone=1700;
    Percu_basic[0].Noise=0;
    Percu_basic[0].Shape=1;
    Percu_basic[0].Period=800;
    
    // Snare
    Percu_basic[1].isTone=true;
    Percu_basic[1].isNoise=true;
    Percu_basic[1].Tone=1000;
    Percu_basic[1].Noise=0;
    Percu_basic[1].Shape=1;
    Percu_basic[1].Period=1400;
    
    // Hi
    Percu_basic[2].isTone=false;
    Percu_basic[2].isNoise=true;
    Percu_basic[2].Tone=0;
    Percu_basic[2].Noise=0;
    Percu_basic[2].Shape=1;
    Percu_basic[2].Period=400;  //200
    // end
    
    // genera las estructuras de datos de las envolventes
    for(i=0;i<8;i++)
    {
      env_list[i].isLoop = enve_loop[i];
      for(o=0;o<16;o++)
      {
        env_list[i].ampValues[o] = enve_data[conta++];
      }    
    }
    // end
    
    
    // genera los patrones de percusion y tono
    genDrumPattern();
    genTonePattern();
    CopyPrevPatterns();
      
  
    POKE(PLAY_HARDW,0); //selecciona AY interno
    
    FillRAM(PSG_RAM,13,0);  //borra el area del buffer de registros del PSG
    
    // activa los canales A y B del AY (registro 7)  
    setChannelRAM(0,true,false);
    setChannelRAM(1,true,false);
    
    VPrintNumber(8,2, Tempo, 1);
    
    // muestra los valores de los controles
    switcher(0x1909,isCasio);
    switcher(0x19A9,isAB);
    VPrintNumber(6,14, B_offset, 3);
    
    showEnv(env_selected);
    VPrintNumber(8,17, env_speed, 1);
    switcher(0x1A49,env_list[env_selected].isLoop);
    
    showOctave();
    // end set visual controls values
       
    
    // posiciona el cursor de seleccion de campo 
    VPOKE(vaddr_cursor[cursor_pos],186);   
    
    
    while(1)
    {
      HALT;
      play();
      if (PEEK(PSG_RAM+13)>0 && _DrumEnabled==true) Sound(13,PEEK(PSG_RAM+13)); //lanza envolvente · dispara sonido percusion    && _DrumEnabled==true
      
      if (tempoStep>=Tempo) //control de tempo por ciclos de Vblank 
      {
        tempoStep=0;
        
        // cursor de patron
        VPOKE(0x1AAE+last_step,239);    //borra la ultima posicion
        VPOKE(0x1AAE+pattern_step,185); //muestra el cursor
        last_step = pattern_step;
        // 
        
        
        // control de la percusion
        if(_DrumEnabled==true)
        {
          drum_type = drum_pattern[pattern_step];
          if(drum_type>0)
          {
            if(isCasio==true) tmp_INST= &Percu_casio[drum_type-1];
            else tmp_INST= &Percu_basic[drum_type-1];
            
            setChannelRAM(2,tmp_INST->isTone,tmp_INST->isNoise);
            POKE(PSG_RAM+4,tmp_INST->Tone & 0xFF);      
            POKE(PSG_RAM+5,(tmp_INST->Tone & 0xFF00)/255);      
            POKE(PSG_RAM+6,tmp_INST->Noise); //noise
            POKE(PSG_RAM+10,16); //volumen canal C (16=envolvente)
            POKE(PSG_RAM+11,tmp_INST->Period & 0xFF);      
            POKE(PSG_RAM+12,(tmp_INST->Period & 0xFF00)/255);
            POKE(PSG_RAM+13,tmp_INST->Shape); //envelope wave form   
            
            sdrum_size=7;
            sdrum_color=drumcolor[drum_type];
                        
          }else{
            // es un silencio
            //POKE(PSG_RAM+10,0); //volumen canal C          
          }
        }     
        

        // control del intrumento de acompañamiento
        tone_note = tone_pattern[pattern_step];
        if(tone_note>0)
        {
          freqA = getFreq(tone_note+(_octave*12)); //+ variacion;
          freqB = freqA + B_offset;
          //VPrintNumber(20,0, tone_note, 3);   // TEST ##########################
          //VPrintNumber(24,0, freq1, 5);
          
          POKE(PSG_RAM,freqA & 0xFF);      
          POKE(PSG_RAM+1,(freqA & 0xFF00)/255);
          POKE(PSG_RAM+2,freqB & 0xFF);      
          POKE(PSG_RAM+3,(freqB & 0xFF00)/255);
          
          env_step=0;          
        }
        
               
        // control de posicion de pattern
        pattern_step++;
        if(pattern_step>ENDstep)
        {
          pattern_step=0;
          ENDstep = newENDstep;
        } 
        
      }else{
        tempoStep++;
        POKE(PSG_RAM+13,0); //envelope wave form 
        drum_type=0;    
      }
      
      
      
      
      if (_isTone==true)
      {
        //control de volumen del tono (envolvente) #############################
        amp = env_list[env_selected].ampValues[env_step];
        
        // calcula siguiente posicion.
        env_step+=env_speed;
        
        if (env_step>15) //control de tamaño de envolvente
        {
          if (env_list[env_selected].isLoop==true) env_step=0;
          else env_step=15; // ultimo valor de la envolvente
        }
        
      }else{
        amp=0;
      }      
      
      POKE(PSG_RAM+8,amp);
      if(isAB==true) POKE(PSG_RAM+9,amp);
      else POKE(PSG_RAM+9,0);
      
          
      
            
      // VISUALS ###############################################################
      
      //Tone
      SetSpritePosition(0,xvalues[stone_step],yvalues[stone_step]);
      SetSpritePattern(0,amp/2);// /2
      SetSpriteColor(0,15);
      stone_step++;
      if (stone_step>63) stone_step=0;
      
      
      //Drum
      if (_DrumEnabled==false)
      {
        POKE(PSG_RAM+10,0); //volumen canal C
        sdrum_size=0;
      }
      
/*      else
      {
        if (drum_type>0){        
          sdrum_size=7;
          sdrum_color=drumcolor[drum_type];  
        }              
      }*/
       
      if(sdrum_size==0) sdrum_color=drumcolor[0];
      SetSpritePosition(1,xvalues[sdrum_step],yvalues[sdrum_step]);
      SetSpritePattern(1,sdrum_size);
      SetSpriteColor(1,sdrum_color);
      
      if (sdrum_size>0) sdrum_size--;
      //VPrintNumber(24,0, sdrum_size, 3); //test
      sdrum_step++;
      if (sdrum_step>63) sdrum_step=0;
      // END VISUALS ###########################################################
      
      
      
      joyval=STICK(0);
      if(joyval==0) joyval=STICK(1);
  
      if (joyval>0)
      {
        if (joybool==false)
        {
          joybool = true;
          VPOKE(vaddr_cursor[cursor_pos],32);       
          
          if(joyval==1) // arriba
          { 
            cursor_pos--;
            if(cursor_pos<0) cursor_pos=8; 
          }
          if(joyval==5) // abajo
          {
            cursor_pos++;
            if(cursor_pos>8) cursor_pos=0;           
          }
          if(joyval==3) // right
          { 
            switch (cursor_pos)   //{0x1841,0x1901,0x19A1,0x19C1,0x1A01,0x1A21,0x1A41,0x1A81,0x1AA1};
            {
              case 0: //tempo
                if (Tempo<8) Tempo++;                
                VPrintNumber(8,2, Tempo, 1);
                break;
              case 1: //CASIO DRUMS?
                isCasio=true;
                switcher(0x1909,true); 
                break;
              case 2: //A+B
                isAB=true;
                switcher(0x19A9,true); 
                break;
              case 3: //B offset
                if (B_offset<254) B_offset++;                
                VPrintNumber(6,14, B_offset, 3); 
                break;
              case 4: //envelope wave
                if (env_selected<7) env_selected++;
                showEnv(env_selected);
                switcher(0x1A49,env_list[env_selected].isLoop); 
                break;
              case 5: //envelope speed
                if (env_speed<3) env_speed++;
                VPrintNumber(8,17, env_speed, 1); 
                break;
              case 6: //loop
                env_list[env_selected].isLoop=true;
                switcher(0x1A49,true);
                break;
              case 7: // _octave +
                downOctave(); 
                break;
              case 8:
                downNotePattern(); 
                break;
            } 
          }
          if(joyval==7) // left
          { 
            switch (cursor_pos) 
            {
              case 0:
                if (Tempo>1) Tempo--;                
                VPrintNumber(8,2, Tempo, 1); 
                break;
              case 1:
                isCasio=false;
                switcher(0x1909,false); 
                break;
              case 2:
                isAB=false;
                switcher(0x19A9,isAB); 
                break;
              case 3:
                if (B_offset>0) B_offset--;                
                VPrintNumber(6,14, B_offset, 3); 
                break;
              case 4:
                if (env_selected>0) env_selected--;
                showEnv(env_selected);
                switcher(0x1A49,env_list[env_selected].isLoop); 
                break;
              case 5:
                if (env_speed>0) env_speed--;
                VPrintNumber(8,17, env_speed, 1); 
                break;
              case 6:
                env_list[env_selected].isLoop=false;
                switcher(0x1A49,false); 
                break;
              case 7: //_octave -
                upOctave();
                break;
              case 8:
                upNotePattern(); 
                break;
            } 
          }
          VPOKE(vaddr_cursor[cursor_pos],186);
        }
      }else{
        joybool = false;
      }
      

      keyPressed = GetKeyMatrix(0);
      if (keyPressed!=0xFF)
      {
        if(keyB0pressed==false)
        {
          //if (!(keyPressed&Bit0)) {keyB0pressed=true;}; // 0
          if (!(keyPressed&Bit1)) {newENDstep=1;keyB0pressed=true;}; // 1
          if (!(keyPressed&Bit2)) {newENDstep=3;keyB0pressed=true;}; // 2
          if (!(keyPressed&Bit3)) {newENDstep=7;keyB0pressed=true;}; // 3
          if (!(keyPressed&Bit4)) {newENDstep=15;keyB0pressed=true;}; // 4
          //if (!(keyPressed&Bit5)) {keyB0pressed=true;}; // 5
          //if (!(keyPressed&Bit6)) {keyB0pressed=true;}; // 6
          //if (!(keyPressed&Bit7)) {keyB0pressed=true;}; // 7
        }      
      }else keyB0pressed=false;
      
      
      
      keyPressed = GetKeyMatrix(2);
      if (keyPressed!=0xFF)
      {
        if(keyB2pressed==false)
        {
          //if (!(keyPressed&Bit0)) {keyB2pressed=true;}; // '
          //if (!(keyPressed&Bit1)) {keyB2pressed=true;}; // £
          if (!(keyPressed&Bit2)) {upNotePattern();keyB2pressed=true;}; // ,/<
          if (!(keyPressed&Bit3)) {downNotePattern();keyB2pressed=true;};   // ./>
          //if (!(keyPressed&Bit4)) {keyB2pressed=true;}; // /
          //if (!(keyPressed&Bit5)) {keyB2pressed=true;}; // DEAD
          //if (!(keyPressed&Bit6)) {keyB2pressed=true;}; // A
          //if (!(keyPressed&Bit7)) {keyB2pressed=true;}; // B
        }      
      }else keyB2pressed=false;
      
      
      
      keyPressed = GetKeyMatrix(6);
      if (keyPressed!=0xFF)
      {
        if(keyB6pressed==false)
        {
          if (!(keyPressed&Bit0)) {CopyPrevPatterns();genTonePattern();keyB6pressed=true;}; // SHIFT
          if (!(keyPressed&Bit1)) {CopyPrevPatterns();genDrumPattern();keyB6pressed=true;}; // CTRL
          //if (!(keyPressed&Bit2)) {keyB6pressed=true;}; // GRAPH
          //if (!(keyPressed&Bit3)) {keyB6pressed=true;}; // CAPS
          //if (!(keyPressed&Bit4)) {keyB6pressed=true;}; // CODE
          if (!(keyPressed&Bit5)) {invertDrumChannel();keyB6pressed=true;}; // F1
          if (!(keyPressed&Bit6)) {invertToneChannel();keyB6pressed=true;}; // F2
          //if (!(keyPressed&Bit7)) {keyB6pressed=true;}; // F3
        }      
      }else keyB6pressed=false;
      
      
     
      
      keyPressed = GetKeyMatrix(7);
      if (keyPressed!=0xFF)
      {
        if(keyB7pressed==false)
        {
          //if (!(keyPressed&Bit0)) {keyB7pressed=true;}; // F4
          //if (!(keyPressed&Bit1)) {keyB7pressed=true;}; // F5
          //if (!(keyPressed&Bit2)){}; // ESC
          if (!(keyPressed&Bit3)) {CopyPrevPatterns();genDrumPattern();genTonePattern();keyB7pressed=true;}; // TAB
          if (!(keyPressed&Bit4)) {setChannelsState(false);keyB7pressed=true;}; // STOP
          if (!(keyPressed&Bit5)) {RestorePrevPatterns();keyB7pressed=true;}; // BS
          if (!(keyPressed&Bit6)) 
          {
            if(isCasio==true) isCasio=false;
            else isCasio=true;
            switcher(0x1909,isCasio); 
            keyB7pressed=true;
          }; // SELECT
          if (!(keyPressed&Bit7)) {setChannelsState(true);keyB7pressed=true;}; // RETURN
        }
      }else keyB7pressed=false;
      
   
      keyPressed = GetKeyMatrix(8);
      if (keyPressed!=0xFF)
      {
        if(keyB8pressed==false)
        {
          //if (!(keyPressed&Bit0)) {keyB8pressed=true;}; // Space
          //if (!(keyPressed&Bit1)) {Help();keyB8pressed=true;}; // Home
          if (!(keyPressed&Bit2)) {upOctave();keyB8pressed=true;}; // Ins
          if (!(keyPressed&Bit3)) {downOctave();keyB8pressed=true;}; // Del
          //if (!(keyPressed&Bit4)) {keyB8pressed=true;}; // Left
          //if (!(keyPressed&Bit5)) {keyB8pressed=true;}; // Up
          //if (!(keyPressed&Bit6)) {keyB8pressed=true;}; // Down
          //if (!(keyPressed&Bit7)) {keyB8pressed=true;}; // Right
        }      
      }else keyB8pressed=false;      
            
    }// Infinite loop
    

}



void invertDrumChannel()
{
    if(_DrumEnabled==true) _DrumEnabled=false;
    else _DrumEnabled=true;
              
    showSpeaker(0x18CA,_DrumEnabled); 
}



void invertToneChannel()
{
    if(_isTone==true) _isTone=false;
    else _isTone=true;
    
    showSpeaker(0x198A,_isTone);
}



void setChannelsState(boolean state)
{
    _DrumEnabled=state;     
    _isTone=state;              
    showSpeaker(0x18CA,state);
    showSpeaker(0x198A,state);
}



void checkMSX(void) 
{
  
  // identifica modelo de MSX
  //0 - MSX1, 1 - MSX2, 2 - MSX2+, 3 - TR, 4 - OCM
  VDP_type = PEEK(0x2D);

  
//2BH b7	   Periodo de sincronismo (VSYNC) 0:60Hz	1:50Hz   
/*  
  ld a,($ffe8)
	bit 1,a
	jr z,its_60hz
	
	;its_50Hz
	
its_60hz:
	
	*/

   
}



// vuelca desde una area de la RAM (PSG_RAM), 
// los valores de los registros del PSG
// a tres diferentes chips (AY interno, AY Pazos y SCC)
void play()
{
__asm
  ld HL,#PSG_RAM ; direccion de memoria del buffer	
	ld B,#13       ; numero de registros
	
  ld A,(#PLAY_HARDW) ;//indica que chip utiliza (0=AY interno, 1=AY pazos)
  cp #0
  jr NZ,MFR_CPY
  
  ;PSG intern
  xor A	
  ld C,#0xA1
ILOOP:
  out (#0xA0),A
  inc A
  outi  
  JR NZ,ILOOP  
  ret
  
MFR_CPY:
  cp #1
  jr NZ,SCC_CPY
  
  ;MEGAFLASHROM PSG
  xor A	
  ld C,#0x11
MLOOP:
  out (#0x10),A
  inc A
  outi  
  JR NZ,MLOOP  
  ret
  
SCC_CPY:
  ret

__endasm;
}




// activa tono y ruido de uno de los tres canales del PSG
void setChannelRAM(char NumChannel, boolean isTone, boolean isNoise)
{
  char newValue;
  
  newValue = GetSound(7);
  
  if(NumChannel==0) 
  {
      if(isTone==true){newValue&=254;}else{newValue|=1;}
      if(isNoise==true){newValue&=247;}else{newValue|=8;}
  }
  if(NumChannel==1)    
  {
      if(isTone==true){newValue&=253;}else{newValue|=2;}
      if(isNoise==true){newValue&=239;}else{newValue|=16;}
  }
  if(NumChannel==2)
  { 
      if(isTone==true){newValue&=251;}else{newValue|=4;}
      if(isNoise==true){newValue&=223;}else{newValue|=32;}
  }
  //sound_set(7,newValue);
  POKE(PSG_RAM+7,newValue);
}




// genera un valor aleatorio de 8 bits y le aplica una máscara
// necesita de un char en la RAM (SEED)
char Rnd(char value) __naked
{
value;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
  
  ld   C,4(ix) ;recoge el valor de la mascara  	
  
  ld   A,R		;  
  ld	 B,A
  
  ld   A,(SEED)
  SRA  A
  
	add	 A,B		
	;add	A,A
	
	ld   B,A
	
	ld   A,R		;  
	add	 A,B
	
	inc	 A
  
  ld   (SEED),A
    
  AND  C  ;aplica la mascara     
  
  
  ld   L,A
  pop  IX
  
  ret   
__endasm;
}



void pressKey()
{
__asm   
    call CHGET
__endasm;
}



void CopyPrevPatterns()
{
  char i;
  
  for(i=0;i<16;i++)
  {
    prev_drum_pattern[i] = drum_pattern[i]; //copy pattern
    prev_tone_pattern[i] = tone_pattern[i];
  }
}




void RestorePrevPatterns()
{
  char i;
  char drum;
  char tone;
  
  uint vaddrDrum = SEQVIEWER1LINE;
  uint vaddrTone = SEQVIEWER2LINE;
    
  for(i=0;i<16;i++)
  {
    drum = drum_pattern[i];
    tone = tone_pattern[i];
       
    drum_pattern[i]=prev_drum_pattern[i];
    tone_pattern[i]=prev_tone_pattern[i];
    
    prev_drum_pattern[i] = drum;
    prev_tone_pattern[i] = tone;
    
    VPOKE(vaddrDrum++,drum_pattern[i]+180); //draw drum
    
    //draw tone
    if(tone_pattern[i]==0) VPOKE(vaddrTone++,180);
    else VPOKE(vaddrTone++,184);    
  }
}



// genera un patron de ritmo de forma aleatoria
void genDrumPattern()
{
  char hits;
  char kicks;
  char snares;
  char conta=0;
  char increment=0;
  uint vaddr = SEQVIEWER1LINE;
  
  char i;  
  
  
  for(i=0;i<16;i++) drum_pattern[i]=0;
  
  hits=Rnd(3);  
  if(hits>0)
  {
    //hits++;
    do{
      conta+=hits;
      if(conta<16) drum_pattern[conta]=3;       
    }while(conta<16); 
  }
  
  conta=0;
  kicks=Rnd(3)*2;
  if(kicks>0)
  {
    do{      
      drum_pattern[conta]=1;
      conta+=kicks;       
    }while(conta<16); 
  }
  
  conta=0;
  snares=Rnd(3)*4;
  if(snares>0)
  {
    do{
      conta+=snares;
      if(conta<16) drum_pattern[conta]=2;       
    }while(conta<16); 
  }
  
  for (i=0;i<16;i++) VPOKE(vaddr++,drum_pattern[i]+180);  //draw new pattern
  
}



// genera un patron de tono de forma aleatoria
void genTonePattern()
{
  char type;
  char value;
  char conta=0;
  char increment=0;
  uint vaddr = SEQVIEWER2LINE;
  
  char i;
  
  
  for(i=0;i<16;i++) tone_pattern[i]=0;
  
  type=Rnd(3)+1; 
  if (type==1) increment=0;
  if (type==2) increment=4;
  if (type>2) increment=2;
   
  type++;
  for(i=1;i<type;i++)
  {
    value=Rnd(15);
    if(value>11) value=0;
    tone_pattern[conta]=value+1;
    conta=conta+increment;
  }
  for(i=0;i<8;i++)
  {
    tone_pattern[i+8]=tone_pattern[i];
  }
  
  //draw new pattern
  for (i=0;i<16;i++){
    if(tone_pattern[i]==0) VPOKE(vaddr++,180);
    else VPOKE(vaddr++,184);
  }
    
  return;
}



void upOctave()
{
  if (_octave>1) _octave--;
  showOctave();
}



void downOctave()
{
   if (_octave<6) _octave++;
   showOctave();
}



void showOctave()
{
    VPrintNumber(8,20, _octave, 1);
}



// sube una nota el patron de tono
void downNotePattern()
{
  char i;
  char value;
  
  for(i=0;i<16;i++)
  {
    value = tone_pattern[i];
    if(value>0 && value<96) tone_pattern[i]=value+1;
  }
  
  return;  
}



// baja una nota el patron de tono
void upNotePattern()
{
  char i;
  char value;
  
  for(i=0;i<16;i++)
  {
    value = tone_pattern[i];
    if(value>1) tone_pattern[i]=value-1;
  }
  
  return;  
}



// proporciona la frecuencia a partir de un numero de nota
// A=num de nota (0>96) HL=valor freq
int getFreq(char value) __naked
{
value;
__asm 
  push IX
  ld   IX,#0
  add  IX,SP
  
  ld A,4(IX)  

;GETFREQ:  
  SLA A    ; x2 (rotacion izquierda sin acarreo) 
  ld D,#0
  ld E,A
  ld IY,#VNOTAS
  add IY,DE
  
  ld L,(IY)
  ld H,1(IY)
  
  pop IX
  ret

VNOTAS:				
  .dw 0
	; Octava 0 (0)
  .dw 0x0D5D,0x0C9C,0x0BE7,0x0B3C,0x0A9B,0x0A02,0x0973,0x08EB,0x086B,0x07F2,0x0780,0x0714 
	; Octava 1 (24)
	.dw	0x06AE,0x064E,0x05F4,0x059E,0x054D,0x0501,0x04B9,0x0475,0x0435,0x03F9,0x03C0,0x038A
	; Octava 2 (48)
	.dw	0x0357,0x0327,0x02FA,0x02CF,0x02AF,0x0281,0x025D,0x023B,0x021B,0x01FC,0x01E0,0x01C5
	; Octava 3 (72)
	.dw	0x01AC,0x0194,0x017D,0x0168,0x0153,0x0140,0x012E,0x011D,0x010D,0x00FE,0x00F0,0x00E2
	; Octava 4 (96)
	.dw	0x00D6,0x00CA,0x00BE,0x00B4,0x00AA,0x00A0,0x0097,0x008F,0x0087,0x007F,0x0078,0x0071
	; Octava 5 (120)
	.dw	0x006B,0x0065,0x005F,0x005A,0x0055,0x0050,0x004C,0x0047,0x0043,0x0040,0x003B,0x0039
	; Octava 6 (144)
	.dw	0x0035,0x0032,0x0030,0x002D,0x002A,0x0028,0x0026,0x0024,0x0022,0x0020,0x001E,0x001C
	; Octava 7 (168)
	.dw	0x001B,0x0019,0x0018,0x0016,0x0015,0x0014,0x0013,0x0012,0x0011,0x0010,0x000F,0x000E

__endasm;
}



/* =============================================================================
 It provides the address of the video memory map tiles, from the screen position
 indicated.
 Proporciona la direccion de la memoria de video del mapa de tiles, a partir de
 la posicion de pantalla indicada.
 Inputs:
   column (char) 0 - 31
   line (char) 0 - 23
============================================================================= */
uint GetVAddressByPosition(char column, char line)
{
   return BASE10 + (line*32)+column;
}



void VPrintNumber(char posx, char posy, uint aNumber, char aLength)
{
  char pos=5;
  uint tiladdre=0;

  char strBuff[]="     ";    

  num2Dec16(aNumber, strBuff);
  
  // proporciona la direccion de la VRAM a partir de una posicion
  tiladdre = GetVAddressByPosition(posx, posy);
  
  //coloca el puntero en la posicion donde se ha de empezar a mostrar 
  pos = 5-aLength;
  
  // muestra el numero en la pantalla
  while (aLength-->0){ VPOKE(tiladdre++,strBuff[pos++]);}
}



void num2Dec16(uint aNumber, char *address)
{
  aNumber;
  address;
__asm
  push IX
  ld   IX,#0
  add  IX,SP
  
  ld   L,4(ix)
  ld   H,5(ix)
  
  ld   E,6(ix)
  ld   D,7(ix)
  	
  ld   BC,#-10000
	call $Num1
	ld   BC,#-1000
	call $Num1
	ld   BC,#-100
	call $Num1
	ld   C,#-10
	call $Num1
	ld   C,B
	call $Num1
  jr   $Num3  
$Num1:	
  ld   A,#-1 ;ASCII-1 47 
$Num2:	
  inc	 A
	add	 HL,BC
	jr	 C,$Num2
	sbc	 HL,BC
	ld	 (DE),A
	inc	 DE
	ret
$Num3:	
  ;END
  pop  IX
  
__endasm;
}



// muestra un control tipo switch (interruptor)
void switcher(uint vaddr, boolean value)
{
  if(value==true)
  {
    VPOKE(vaddr++,221);
    VPOKE(vaddr,223);
  }else{
    VPOKE(vaddr++,223);
    VPOKE(vaddr,222);  
  }
  return;
}



// muestra el valor de la envolvente
void showEnv(char value)
{
  VPrintNumber(8,16, value, 3);
  value=value*2+192;
  VPOKE(0x1A06,value++);
  VPOKE(0x1A07,value++);
}



// muestra el indicador de activación de canal de audio (altavoz)
void showSpeaker(uint vaddr, boolean value)
{
  if(value==true) VPOKE(vaddr,187);
  else VPOKE(vaddr,188);
    
  return;
}






void showLogoScreen() __naked
{
__asm
  ld   HL,#titlescreen_PAT
  ld   DE,#BASE12
  call unRLEWBVRAM
           
  ld   HL,#titlescreen_COL
  ld   DE,#BASE11
  call unRLEWBVRAM

    
  ld   HL,#titlescreen_SPRPATTERNS
  ld   DE,#BASE14
  jp   unRLEWBVRAM
  



; Project: The Alan Random Project (TARP)
; Picture: TARP_titlescreen_BG
; RLE WB compressed - Original size= 6144 - Final size= 1270
titlescreen_PAT:
.db 0x80,0x03,0xFF,0x03,0x03,0x80,0x05,0x00,0xF6,0xF6,0xC7,0xC7,0x80,0x05,0x00,0x87
.db 0xCF,0x80,0x06,0x00,0x80,0x00,0x80,0x03,0x00,0x1C,0x1C,0x36,0x37,0x80,0x03,0x00
.db 0x38,0x38,0x18,0x18,0x80,0x05,0x00,0x39,0x3D,0x80,0x05,0x00,0xE0,0xF0,0x80,0x03
.db 0x00,0x07,0x07,0x06,0x06,0x80,0x03,0x00,0x80,0x00,0x80,0x00,0xC3,0xE3,0x80,0x05
.db 0x00,0x9E,0xDF,0x80,0x03,0x00,0x03,0x03,0x0F,0x1F,0x80,0x05,0x00,0x38,0x7C,0x80
.db 0x05,0x00,0xC4,0xEE,0x80,0x05,0x00,0x70,0xF0,0x80,0x03,0x00,0x80,0x03,0x03,0x80
.db 0x03,0x00,0xC0,0xC0,0x67,0x77,0x80,0x05,0x00,0xC7,0xEF,0x80,0x03,0x00,0x03,0x03
.db 0x00,0x83,0x80,0x05,0x00,0x1C,0x3E,0x80,0x05,0x00,0x38,0x7C,0x80,0x03,0x00,0x30
.db 0x30,0x78,0x78,0x80,0x57,0x00,0x80,0x07,0xC6,0xCD,0x6F,0x6F,0x80,0x02,0x6C,0x6F
.db 0x67,0x80,0x02,0x80,0x00,0x00,0xC0,0xC0,0x80,0x00,0x33,0x3F,0x3F,0x80,0x04,0x33
.db 0x80,0x05,0x18,0x7E,0x7E,0x0D,0x7D,0x7D,0x80,0x02,0xCD,0xFD,0x7D,0xB0,0x80,0x06
.db 0x98,0x80,0x02,0x06,0x07,0x07,0x80,0x02,0x06,0x60,0x67,0x67,0xCC,0xCC,0x8C,0xCF
.db 0xC7,0xDB,0x80,0x06,0xD9,0x1B,0x80,0x04,0xB3,0xBF,0x9F,0x6C,0x80,0x04,0x66,0x7E
.db 0x3C,0x80,0x02,0xFE,0xD6,0xD6,0x80,0x02,0xC6,0xC0,0x78,0x78,0x0C,0x0C,0xCC,0xFC
.db 0x78,0x80,0x07,0x03,0x80,0x02,0x36,0xE6,0xE6,0x80,0x02,0x06,0x6D,0x80,0x04,0x0C
.db 0x0F,0x07,0x83,0x80,0x04,0xC3,0xCB,0x8B,0x36,0x3E,0x3E,0x30,0x30,0x33,0x3F,0x1E
.db 0x64,0x80,0x03,0x60,0x66,0x7E,0x3C,0x80,0x04,0x30,0x34,0x3C,0x18,0x80,0x97,0x00
.db 0x60,0x60,0x80,0x45,0x00,0x06,0x06,0x80,0xFE,0x00,0x80,0xFE,0x00,0x80,0x2D,0x00
.db 0x01,0x03,0x80,0x04,0x00,0x07,0xFF,0xFF,0x80,0x03,0x00,0x80,0x03,0xFF,0x80,0x03
.db 0x00,0x80,0x03,0xFF,0x80,0x04,0x00,0xF0,0xFF,0xFF,0x80,0x06,0x00,0xC0,0x80,0xCA
.db 0x00,0x03,0x07,0x0F,0x1F,0x3F,0x1F,0x3F,0x80,0x25,0xFF,0xF0,0xF8,0xFC,0xFE,0x80
.db 0x03,0xFF,0x80,0x04,0x00,0x80,0x00,0x80,0x00,0xC0,0x80,0xBA,0x00,0x01,0x01,0x03
.db 0x07,0x06,0x7F,0x7F,0x80,0x03,0xFF,0xBF,0x3F,0x80,0x2F,0xFF,0xE0,0xE0,0x80,0x02
.db 0xF0,0xF8,0xF8,0xFC,0x80,0x5B,0x00,0x03,0x0F,0x1F,0x1F,0x80,0x02,0x00,0x70,0xFC
.db 0x80,0x02,0xFF,0x80,0x05,0x00,0x80,0x00,0x80,0x00,0x00,0x00,0x07,0x1F,0x3F,0x7F
.db 0x7F,0xFE,0xFF,0xFF,0xE0,0xF8,0xFC,0xFC,0xFE,0x3F,0x80,0x37,0xFF,0x06,0x04,0x04
.db 0x80,0x04,0x08,0xC0,0x80,0x06,0x80,0x80,0x2F,0x00,0x80,0x03,0x03,0x80,0x03,0x01
.db 0x80,0x57,0xFF,0x80,0x04,0xC0,0xE0,0xE0,0xF0,0x00,0x8F,0x80,0x02,0x07,0x8F,0xFF
.db 0x01,0x80,0x03,0x3F,0x7F,0x7F,0xFF,0xFF,0x80,0x02,0xFC,0xFE,0x80,0x00,0xC0,0xE0
.db 0xF0,0x80,0x02,0x1F,0x3F,0x01,0x01,0x03,0x07,0x80,0x37,0xFF,0x08,0x00,0x80,0x03
.db 0x08,0x00,0x08,0x80,0x07,0x80,0x80,0x2F,0x00,0x01,0x80,0x06,0x00,0x80,0x57,0xFF
.db 0x80,0x07,0x01,0x80,0x06,0xFC,0x01,0x80,0x03,0xFF,0x00,0x00,0x7F,0xC1,0x80,0x03
.db 0x07,0x80,0x02,0x0F,0x03,0x0F,0x80,0x02,0x1F,0x3F,0x3F,0xC0,0xC0,0x80,0x37,0x00
.db 0x08,0x00,0x00,0x04,0x04,0x80,0x02,0x00,0x80,0x02,0x80,0x80,0x02,0xC0,0xE0,0xE0
.db 0x80,0x31,0x00,0x80,0x04,0x01,0x03,0x80,0x51,0xFF,0xFC,0xF0,0xE0,0xE0,0xC0,0xC0
.db 0xFC,0xF8,0x70,0x03,0x07,0x0F,0x1F,0x3F,0x02,0x80,0x0E,0x00,0x20,0x80,0x06,0x00
.db 0x3F,0x1C,0xC0,0xE0,0xF0,0xF8,0xF8,0xFC,0xFF,0x1F,0x0F,0x07,0x03,0x03,0x01,0x01
.db 0x80,0x37,0xFF,0x80,0x02,0x0F,0x07,0x07,0x03,0x03,0x01,0x80,0x2F,0xFF,0xFC,0xFC
.db 0xF8,0xF8,0xF0,0xE0,0xC0,0x80,0x00,0x80,0x4F,0x00,0x80,0x03,0xC0,0xE0,0xF8,0xFE
.db 0x01,0x3F,0x7F,0x7F,0x80,0x03,0x80,0x80,0x05,0x00,0xFE,0xFE,0x80,0x06,0xFF,0x7F
.db 0x3F,0x80,0x03,0xFF,0xEF,0xEF,0xCF,0x9F,0xFE,0xFE,0x80,0x02,0x01,0x80,0x02,0x00
.db 0x80,0x02,0x01,0x03,0x07,0x1F,0xC0,0xC0,0x80,0x3F,0x00,0xFF,0x80,0x00,0xE0,0xF0
.db 0xF8,0xFC,0xFF,0xFF,0x80,0x06,0x00,0xF0,0x80,0x0E,0x00,0x01,0x80,0x04,0x00,0x01
.db 0x0F,0xFF,0x00,0x01,0x03,0x0F,0x7F,0x80,0x58,0xFF,0x01,0x1F,0x80,0x03,0x01,0x03
.db 0x1F,0x07,0x3F,0x80,0x0F,0xFF,0x8E,0xE0,0x80,0x05,0xFF,0x3F,0x80,0x0E,0xFF,0xC0
.db 0xC0,0xE0,0xE0,0xFF,0x80,0x00,0x80,0x05,0xFF,0x07,0x00,0xE0,0x01,0x80,0x04,0xFF
.db 0x80,0x00,0xF0,0xFC,0x80,0xA8,0x00,0x01,0x80,0x02,0x03,0x80,0x02,0x07,0x03,0x1F
.db 0x3F,0x7F,0x80,0x00,0x80,0x09,0x00,0xC0,0x80,0x06,0xFF,0x80,0x00,0x80,0x14,0x00
.db 0x09,0x1D,0x14,0x80,0x04,0x00,0x10,0xB0,0xE0,0x80,0x05,0x00,0x3F,0x7F,0x80,0x05
.db 0x00,0xF8,0xFE,0x0F,0x03,0x01,0x01,0x80,0x03,0x00,0xFF,0x80,0x00,0x80,0x00,0x80
.db 0x04,0xC0,0x80,0x9F,0x00,0x80,0x07,0x07,0x80,0x07,0xFF,0x80,0x00,0xF0,0xE0,0x80
.db 0x02,0xC0,0xE0,0xE0,0x80,0x07,0x80,0x80,0x0F,0x00,0x3E,0x22,0x22,0x80,0x04,0x00
.db 0x80,0x02,0x40,0x80,0x04,0x00,0x80,0x07,0xE0,0x0F,0x07,0x80,0x05,0x03,0x80,0x07
.db 0xFF,0x80,0x06,0xC0,0x80,0x00,0x80,0x9F,0x00,0x03,0x03,0x01,0x01,0x80,0x03,0x00
.db 0x80,0x00,0x80,0x00,0xC0,0xE1,0xFF,0xC0,0xFF,0xFF,0x80,0x02,0x0E,0x1E,0x3E,0x7E
.db 0xFE,0xFE,0x80,0x07,0x80,0x80,0x1F,0x00,0x80,0x06,0xE0,0xFC,0x03,0x01,0x01,0x80
.db 0x04,0x00,0x81,0x83,0x01,0x87,0x80,0x03,0xFF,0x7F,0x80,0xB6,0xFF,0x80,0x07,0xFC
.db 0x80,0x00,0x80,0x14,0x00,0xC0,0x80,0x00,0x80,0x05,0xFF,0x07,0x01,0x80,0x07,0xFF
.db 0x01,0x0F,0x07,0x80,0x02,0x03,0x01,0x01,0x80,0x03,0xFF,0x80,0x03,0x80,0x80,0xBF
.db 0x00,0x80,0x07,0x03,0x80,0x04,0xFF,0x80,0x02,0x80,0x00,0x80,0x06,0x01,0xE0,0xC0
.db 0x80,0x05,0x80,0x0F,0x07,0x03,0x03,0x80,0x03,0x01,0xFF,0xFF,0x80,0x05,0x80,0x80
.db 0x07,0x01,0x80,0x07,0x80,0x80,0xA5,0x00,0x01,0x7F,0x80,0x04,0x00,0x1F,0x03,0x80
.db 0x04,0xFF,0x0F,0x01,0x80,0x04,0xFF,0x0F,0x80,0x03,0xFF,0x01,0x00,0x00,0xFF,0x80
.db 0x00,0x80,0x02,0x00,0xC0,0xF0,0x80,0x00,0x00,0x80,0x03,0xFF,0x03,0xC0,0x80,0x0D
.db 0xFF,0x80,0x02,0x01,0xFF,0xFF,0xE0,0xF8,0xFE,0x80,0x05,0x80,0xC0,0xE0,0x80,0x05
.db 0x01,0x03,0x07,0x80,0x04,0x80,0x03,0x07,0x00,0x80,0x05,0xFF,0x01,0x01,0x80,0x06
.db 0xFF,0x01,0x80,0x75,0xFF,0xF8,0xC0,0x80,0x03,0xFF,0xF0,0x07,0x3F,0x80,0x02,0xFF
.db 0x0F,0x0F,0x80,0x03,0xFF,0x0F,0xFF,0x80,0x00,0x80,0x04,0x00,0xE0,0x80,0x3E,0x00
.db 0x01,0x80,0x06,0x00,0x80,0x00,0xC0,0x80,0x00,0x80,0x04,0xFF,0x01,0x07,0x0F,0x80
.db 0x14,0xFF,0xFE,0x80,0x06,0xFF,0x07,0x07,0x80,0x05,0x00,0xFF,0xF0,0xC0,0xFE,0x80
.db 0x05,0xFF,0xC0,0xFE,0x07,0x80,0x02,0x00,0x80,0x03,0xFF,0xF0,0x80,0x00,0xF8,0x80
.db 0x06,0xFF,0x03,0xE0,0x80,0x06,0xFF,0xE0,0x80,0x3F,0x00,0x07,0x3F,0x80,0xB5,0xFF
.db 0x80,0x00,0xF0,0x80,0x06,0xFF,0xF0,0x80,0x00,0xF0,0x80,0x06,0xFF,0xF0,0xFE,0xF0
.db 0x80,0x06,0xFF,0x07,0x01,0xE0,0x80,0x06,0xFF,0x80,0x00,0x80,0x1F,0x00,0x80,0xCF
.db 0xFF,0x01,0x80,0x06,0x00,0x03,0xE0,0xFC,0x80,0x05,0xFF,0x80,0x00,0xFC,0x80,0x00
.db 0xF0,0xFE,0x80,0x04,0xFF,0x80,0x00,0xF0,0xFF,0xC0,0xF0,0x80,0x05,0xFF,0xE0,0xF8
.db 0x80,0x07,0x00,0x80,0xF0,0xFF,0xC0,0xF0,0xFE,0x80,0x04,0xFF,0xF0,0xFF,0xFF,0xC0
.db 0xF0,0xFC,0x80,0xE0,0xFF,0x00,0x00,0x3C,0x80,0x03,0x2A,0x80,0x02,0x00,0x8B,0x88
.db 0x89,0x52,0x21,0x80,0x02,0x00,0xC7,0x28,0xE8,0x28,0xE7,0x00,0x00,0x87,0xF7,0xF7
.db 0xEF,0xDF,0xDF,0xFF,0x80,0xFF
; 
; RLE WB compressed - Original size= 6144 - Final size= 497
titlescreen_COL:
.db 0x80,0x03,0x41,0x80,0xFE,0xF4,0x80,0xFE,0xF4,0x80,0xFE,0xF4,0x80,0xFE,0xF4,0x80
.db 0xBD,0xF4,0x80,0xFE,0x74,0x80,0xFE,0x74,0x80,0x8F,0x74,0x80,0x1A,0x34,0x31,0x41
.db 0x41,0x80,0x04,0x34,0x31,0x80,0x37,0x41,0x80,0x04,0x74,0x54,0x74,0x54,0x80,0x97
.db 0x47,0x80,0x08,0x43,0x80,0x05,0x31,0x80,0x08,0x43,0x80,0x03,0x31,0x80,0x03,0x43
.db 0x80,0x03,0x31,0x80,0x3B,0x43,0x80,0x07,0x54,0x80,0x97,0x47,0x80,0x0C,0x34,0x31
.db 0x31,0x23,0x80,0x05,0x41,0xC1,0x23,0x80,0x04,0x34,0x31,0x31,0x32,0x80,0x05,0x43
.db 0x80,0x39,0x24,0x80,0x07,0x54,0x80,0x91,0x47,0x80,0x08,0x41,0x80,0x04,0x31,0x80
.db 0x17,0x23,0x41,0x41,0x80,0x05,0x31,0x80,0x3F,0x41,0x80,0x8F,0x74,0x80,0x06,0x41
.db 0xC4,0x80,0x02,0x31,0x80,0x02,0xC3,0x80,0x06,0x23,0x80,0x14,0x31,0xC3,0xC3,0x80
.db 0x03,0x23,0x80,0x05,0x41,0x80,0x41,0xC4,0x71,0x80,0x84,0x47,0x80,0x07,0xC4,0x80
.db 0x11,0x3C,0x80,0x17,0x31,0x80,0x04,0xC4,0x2C,0x31,0x31,0x80,0x03,0x41,0x4C,0x4C
.db 0x3C,0x23,0x80,0x04,0x41,0x80,0xB2,0xC4,0x80,0x03,0x3C,0x80,0x0A,0x23,0x80,0x07
.db 0x3C,0x80,0x15,0x23,0x80,0x1D,0xC3,0x80,0x04,0x23,0x41,0x80,0xAE,0xC4,0x80,0x07
.db 0x31,0x2C,0x80,0x06,0xC4,0x80,0x27,0xC3,0x80,0x0F,0xC4,0x80,0x07,0x31,0x80,0xAF
.db 0xC4,0x23,0x80,0x03,0xC3,0x80,0x0A,0x4C,0x80,0x27,0xC3,0x80,0x0F,0xC4,0x23,0xC3
.db 0x80,0xC5,0x4C,0x80,0x15,0x23,0x80,0x11,0x3C,0x4C,0x80,0x06,0xC3,0x80,0x03,0x41
.db 0x80,0xCB,0xC4,0x80,0x04,0x31,0x23,0x80,0x02,0xC3,0x23,0x80,0x05,0xC3,0x80,0x0F
.db 0xC4,0x31,0x31,0x23,0x80,0x0C,0xC3,0x80,0xAD,0xC4,0x80,0x07,0x64,0x96,0x96,0x80
.db 0x03,0x41,0x64,0x80,0x02,0x96,0x80,0x02,0x41,0x64,0x64,0x80,0x02,0x91,0x80,0x02
.db 0xC4,0x61,0x80,0x03,0x69,0xC3,0xC2,0x46,0x46,0x80,0x03,0x91,0xC3,0x2C,0x61,0x61
.db 0x80,0x03,0x91,0x41,0x41,0x61,0x61,0x80,0x03,0x91,0x80,0x02,0xC4,0x61,0x61,0x80
.db 0x02,0x96,0x80,0x0F,0xC3,0x80,0x04,0xC4,0x46,0x69,0x69,0x80,0x05,0x41,0x46,0x69
.db 0x80,0x06,0x41,0x80,0x7D,0x46,0x80,0x02,0x96,0x41,0x41,0x64,0x80,0x04,0x96,0x64
.db 0x64,0x80,0x4D,0x69,0x6C,0x6C,0x80,0x05,0x96,0x9C,0x9C,0x80,0x1D,0x96,0x46,0x80
.db 0x06,0x69,0x41,0x64,0x80,0x05,0x96,0x41,0x41,0x64,0x64,0x80,0x03,0x69,0x80,0x03
.db 0x41,0x64,0x80,0x02,0x96,0x80,0x05,0x41,0x46,0x96,0x80,0x06,0x41,0x80,0x40,0x64
.db 0x80,0xBF,0x96,0x41,0x64,0x80,0x05,0x96,0x80,0x02,0x41,0x64,0x64,0x80,0x02,0x96
.db 0x80,0x04,0x41,0x46,0x46,0x96,0x80,0x06,0x41,0x80,0x20,0x64,0x80,0xCF,0x91,0x80
.db 0x07,0x69,0x46,0x80,0x06,0x96,0x41,0x64,0x64,0x80,0x04,0x96,0x80,0x02,0x41,0x80
.db 0x02,0x64,0x96,0x96,0x80,0x05,0x41,0x80,0x09,0x64,0x80,0xEF,0x91,0x61,0x80,0x06
.db 0x96,0x41,0x80,0x02,0x64,0x80,0xE3,0x96,0x80,0x17,0x79,0xE9,0x80,0x06,0x95,0x80
.db 0xFF





; Project: The Alan Random Project (TARP)
; SpriteSet Pattern Data - Size:16x16
; Sprite range: 0 to 4
; RLE WB compressed - Original size= 160 - Compress size= 116
titlescreen_SPRPATTERNS:
.db 0x01,0x0F,0x38,0x60,0x40,0x80,0x04,0xC0,0x40,0x60,0x30,0x18,0x0C,0x06,0xC0,0xF0
.db 0x1C,0x06,0x06,0x80,0x03,0x03,0x02,0x06,0x04,0x08,0x08,0x18,0x18,0x80,0x06,0x03
.db 0x02,0x04,0x08,0x10,0x20,0x40,0x40,0x80,0x00,0x80,0x00,0x80,0x03,0x08,0x0F,0x08
.db 0x80,0x09,0x00,0x07,0x1C,0x30,0x60,0x40,0x80,0x03,0xC0,0xE0,0x60,0x30,0x18,0x0C
.db 0x04,0x06,0xE0,0x38,0x0C,0x04,0x06,0x80,0x04,0x03,0x06,0x06,0x0C,0x18,0x10,0x20
.db 0x03,0x03,0x80,0x02,0x06,0x7C,0x0C,0x80,0x08,0x00,0x10,0x30,0x80,0x02,0x20,0x60
.db 0x40,0x40,0x20,0x10,0x08,0x04,0x04,0x02,0x01,0x01,0x88,0x80,0x02,0x00,0x88,0x80
.db 0x1A,0x00,0x80,0xFF



__endasm;
}



void setTileset() __naked
{
__asm
  ld hl,#TILESET_PAT
  ld de,#BASE12
  call unRLEWBVRAM
  
  ld hl,#TILESET_PAT
  ld de,#BASE12 + 2048
  call unRLEWBVRAM
  
  ld hl,#TILESET_PAT
  ld de,#BASE12 + 4096
  call unRLEWBVRAM
           
  ld hl,#TILESET_COL
  ld de,#BASE11
  call unRLEWBVRAM
  
  ld hl,#TILESET_COL
  ld de,#BASE11 + 2048
  call unRLEWBVRAM
  
  ld hl,#TILESET_COL
  ld de,#BASE11 + 4096
  jp unRLEWBVRAM
  
 


; Project: The Alan Random Project (TARP)
; tileset pattern
; Tiles range: 0 to 255
; RLE WB compressed - Original size= 2048 - Compress size= 1825
TILESET_PAT:
.db 0xFF,0xC1,0x80,0x02,0x9C,0xC1,0xFF,0x00,0xFF,0xE7,0xC7,0xE7,0xE7,0xC3,0xFF,0x00
.db 0xFF,0x81,0xFC,0xC1,0x9F,0x80,0x00,0x80,0x02,0xFF,0x81,0xFC,0xE1,0xFC,0x81,0x80
.db 0x02,0xFF,0x9C,0x9C,0x80,0x00,0xFC,0xFC,0x80,0x02,0xFF,0x80,0x00,0x9F,0x81,0xFC
.db 0x81,0x80,0x02,0xFF,0xC1,0x9F,0x81,0x9C,0xC1,0x80,0x02,0xFF,0x80,0x00,0xFC,0xF9
.db 0xF3,0xF3,0x80,0x02,0xFF,0xC1,0x9C,0xC1,0x9C,0xC1,0x80,0x02,0xFF,0xC1,0x9C,0xC0
.db 0xFC,0xC1,0xFF,0x00,0x80,0x06,0xFF,0x00,0x80,0x02,0xFF,0xC3,0x80,0x02,0xFF,0x80
.db 0x03,0x00,0xEE,0xA8,0xA8,0xEE,0x80,0x03,0x00,0xEE,0x4A,0x4E,0x4A,0x80,0x03,0x00
.db 0xAE,0xAC,0xA8,0x4E,0x00,0x00,0x6E,0x48,0x4E,0x48,0x68,0x80,0x02,0x00,0x4C,0xC4
.db 0x44,0x44,0xEC,0x80,0x02,0x00,0xCC,0x24,0x44,0x84,0xEC,0x80,0x0A,0x00,0xB7,0xA2
.db 0xB2,0xA2,0xA2,0x80,0x02,0x00,0x80,0x04,0x66,0x80,0x02,0x00,0x60,0x78,0x7E,0x78
.db 0x60,0x80,0x02,0x00,0x60,0x78,0x7E,0x78,0x60,0x80,0x02,0x00,0x80,0x04,0x7E,0x00
.db 0x00,0x80,0x0F,0xFF,0x80,0x02,0x00,0x7B,0x0A,0x7A,0x0A,0x7B,0x80,0x02,0x00,0xDE
.db 0x42,0x5E,0x42,0xDE,0x80,0x02,0x00,0x80,0x00,0xF7,0x94,0x94,0xF7,0x80,0x03,0x00
.db 0xB8,0x24,0x24,0xA4,0xFF,0xFF,0x9C,0x9C,0xC9,0xE3,0x80,0x02,0xFF,0x9F,0x81,0x9C
.db 0x9C,0x81,0x80,0x0A,0xFF,0x80,0x03,0xF3,0xFF,0xF3,0xFF,0xFF,0xEB,0xEB,0x80,0x05
.db 0xFF,0xEB,0xC1,0xEB,0xC1,0xEB,0xFF,0xFF,0xF7,0xC1,0x97,0xC1,0xF4,0xC1,0xF7,0xFF
.db 0xFF,0xCC,0xC9,0xF3,0xE4,0xCC,0x80,0x02,0xFF,0xC7,0x93,0xC2,0x99,0xC2,0x80,0x02
.db 0xFF,0xE7,0xCF,0x80,0x04,0xFF,0xF9,0x80,0x04,0xF3,0xF9,0xFF,0xCF,0x80,0x04,0xE7
.db 0xCF,0xFF,0xFF,0xA5,0xC3,0x81,0xC3,0xA5,0x80,0x02,0xFF,0xE7,0xE7,0x81,0xE7,0xE7
.db 0x80,0x05,0xFF,0xE7,0xE7,0xEF,0x80,0x03,0xFF,0x81,0x80,0x07,0xFF,0xE7,0xE7,0x80
.db 0x02,0xFF,0xF9,0xF3,0xE7,0xCF,0x9F,0x80,0x02,0xFF,0xC1,0x98,0x94,0x8C,0xC1,0x80
.db 0x02,0xFF,0xE7,0xC7,0xE7,0xE7,0xC3,0x80,0x02,0xFF,0x81,0xFC,0xC1,0x9F,0x80,0x00
.db 0x80,0x02,0xFF,0x81,0xFC,0xE1,0xFC,0x81,0x80,0x02,0xFF,0x9C,0x9C,0x80,0x00,0xFC
.db 0xFC,0x80,0x02,0xFF,0x80,0x00,0x9F,0x81,0xFC,0x81,0x80,0x02,0xFF,0xC1,0x9F,0x81
.db 0x9C,0xC1,0x80,0x02,0xFF,0x80,0x00,0xFC,0xF9,0xF3,0xF3,0x80,0x02,0xFF,0xC1,0x9C
.db 0xC1,0x9C,0xC1,0x80,0x02,0xFF,0xC1,0x9C,0xC0,0xFC,0xC1,0x80,0x02,0xFF,0xE7,0xE7
.db 0xFF,0xE7,0xE7,0x80,0x02,0xFF,0xE7,0xE7,0xFF,0xE7,0xE7,0xEF,0xFF,0xFF,0xF3,0xE7
.db 0xCF,0xE7,0xF3,0x80,0x03,0xFF,0xC3,0xFF,0xC3,0x80,0x03,0xFF,0xCF,0xE7,0xF3,0xE7
.db 0xCF,0x80,0x02,0xFF,0xE1,0xCC,0xF9,0xF3,0xFF,0xF3,0xFF,0xC1,0xBE,0xA2,0xAA,0xA0
.db 0xBF,0xC1,0xFF,0xFF,0xC1,0x9C,0x80,0x00,0x9C,0x9C,0x80,0x02,0xFF,0x81,0x9C,0x81
.db 0x9C,0x81,0x80,0x02,0xFF,0xC0,0x80,0x02,0x9F,0xC0,0x80,0x02,0xFF,0x81,0x80,0x02
.db 0x9C,0x81,0x80,0x02,0xFF,0x80,0x00,0x9F,0x83,0x9F,0x80,0x00,0x80,0x02,0xFF,0x80
.db 0x00,0x9F,0x83,0x9F,0x9F,0x80,0x02,0xFF,0xC0,0x9F,0x98,0x9C,0xC0,0x80,0x02,0xFF
.db 0x9C,0x9C,0x80,0x00,0x9C,0x9C,0x80,0x02,0xFF,0xE1,0x80,0x02,0xF3,0xE1,0x80,0x02
.db 0xFF,0xE1,0xF3,0xF3,0x93,0xC7,0x80,0x02,0xFF,0x9C,0x99,0x83,0x99,0x9C,0x80,0x02
.db 0xFF,0x80,0x03,0x9F,0x80,0x00,0x80,0x02,0xFF,0x9C,0x88,0x80,0x00,0x94,0x9C,0x80
.db 0x02,0xFF,0x9C,0x8C,0x84,0x90,0x98,0x80,0x02,0xFF,0xC1,0x80,0x02,0x9C,0xC1,0x80
.db 0x02,0xFF,0x81,0x9C,0x9C,0x81,0x9F,0x80,0x02,0xFF,0xC1,0x9C,0x94,0x99,0xC2,0x80
.db 0x02,0xFF,0x81,0x9C,0x9C,0x81,0x9C,0x80,0x02,0xFF,0xC0,0x9F,0xC1,0xFC,0x81,0x80
.db 0x02,0xFF,0x81,0x80,0x03,0xE7,0x80,0x02,0xFF,0x80,0x03,0x9C,0xC1,0x80,0x02,0xFF
.db 0x80,0x02,0x9C,0xC9,0xE3,0x80,0x02,0xFF,0x9C,0x94,0x80,0x00,0x88,0x9C,0x80,0x02
.db 0xFF,0x9C,0xC9,0xE3,0xC9,0x9C,0x80,0x02,0xFF,0x99,0x99,0xC3,0xE7,0xE7,0x80,0x02
.db 0xFF,0x81,0xF3,0xE7,0xCF,0x81,0xFF,0xFF,0xF1,0x80,0x04,0xF3,0xF1,0xFF,0xFF,0x9F
.db 0xCF,0xE7,0xF3,0xF9,0xFF,0xFF,0xC7,0x80,0x04,0xE7,0xC7,0x80,0x0E,0xFF,0x81,0x80
.db 0x09,0xFF,0xC1,0x9C,0x80,0x00,0x9C,0x9C,0x80,0x02,0xFF,0x81,0x9C,0x81,0x9C,0x81
.db 0x80,0x02,0xFF,0xC0,0x80,0x02,0x9F,0xC0,0x80,0x02,0xFF,0x81,0x80,0x02,0x9C,0x81
.db 0x80,0x02,0xFF,0x80,0x00,0x9F,0x83,0x9F,0x80,0x00,0x80,0x02,0xFF,0x80,0x00,0x9F
.db 0x83,0x9F,0x9F,0x80,0x02,0xFF,0xC0,0x9F,0x98,0x9C,0xC0,0x80,0x02,0xFF,0x9C,0x9C
.db 0x80,0x00,0x9C,0x9C,0x80,0x02,0xFF,0xE1,0x80,0x02,0xF3,0xE1,0x80,0x02,0xFF,0xE1
.db 0xF3,0xF3,0x93,0xC7,0x80,0x02,0xFF,0x9C,0x99,0x83,0x99,0x9C,0x80,0x02,0xFF,0x80
.db 0x03,0x9F,0x80,0x00,0x80,0x02,0xFF,0x9C,0x88,0x80,0x00,0x94,0x9C,0x80,0x02,0xFF
.db 0x9C,0x8C,0x84,0x90,0x98,0x80,0x02,0xFF,0xC1,0x80,0x02,0x9C,0xC1,0x80,0x02,0xFF
.db 0x81,0x9C,0x9C,0x81,0x9F,0x80,0x02,0xFF,0xC1,0x9C,0x94,0x99,0xC2,0x80,0x02,0xFF
.db 0x81,0x9C,0x9C,0x81,0x9C,0x80,0x02,0xFF,0xC0,0x9F,0xC1,0xFC,0x81,0x80,0x02,0xFF
.db 0x81,0x80,0x03,0xE7,0x80,0x02,0xFF,0x80,0x03,0x9C,0xC1,0x80,0x02,0xFF,0x80,0x02
.db 0x9C,0xC9,0xE3,0x80,0x02,0xFF,0x9C,0x94,0x80,0x00,0x88,0x9C,0x80,0x02,0xFF,0x9C
.db 0xC9,0xE3,0xC9,0x9C,0x80,0x02,0xFF,0x99,0x99,0xC3,0xE7,0xE7,0x80,0x02,0xFF,0x81
.db 0xF3,0xE7,0xCF,0x81,0x80,0x02,0xFF,0xE7,0xE7,0xFF,0xE7,0xE7,0xFF,0xFF,0x00,0xF0
.db 0x92,0x92,0x12,0x1E,0x80,0x02,0x00,0x7C,0xFE,0xBA,0x82,0x82,0x7C,0x00,0x00,0xF0
.db 0x92,0x92,0x12,0x1E,0x80,0x02,0x00,0x7C,0xFE,0xBA,0x82,0x82,0x7C,0x80,0x07,0x00
.db 0xFF,0x00,0x3E,0x63,0x7F,0x63,0x63,0x80,0x02,0x00,0x7E,0x63,0x7E,0x63,0x7E,0x80
.db 0x02,0x00,0x3F,0x80,0x02,0x60,0x3F,0x80,0x02,0x00,0x7E,0x80,0x02,0x63,0x7E,0x80
.db 0x02,0x00,0x7F,0x60,0x7C,0x60,0x7F,0x80,0x02,0x00,0x7F,0x60,0x7C,0x60,0x60,0x80
.db 0x02,0x00,0x3F,0x60,0x67,0x63,0x3F,0x80,0x02,0x00,0x63,0x63,0x7F,0x63,0x63,0x80
.db 0x02,0x00,0x1E,0x80,0x02,0x0C,0x1E,0x80,0x02,0x00,0x1E,0x0C,0x0C,0x6C,0x38,0x80
.db 0x02,0x00,0x63,0x66,0x7C,0x66,0x63,0x80,0x02,0x00,0x80,0x03,0x60,0x7F,0x80,0x02
.db 0x00,0x63,0x77,0x7F,0x6B,0x63,0x80,0x02,0x00,0x63,0x73,0x7B,0x6F,0x67,0x80,0x02
.db 0x00,0x3E,0x80,0x02,0x63,0x3E,0x80,0x02,0x00,0x7E,0x63,0x63,0x7E,0x60,0x80,0x02
.db 0x00,0x3E,0x63,0x6B,0x66,0x3D,0x80,0x02,0x00,0x7E,0x63,0x63,0x7E,0x63,0x80,0x02
.db 0x00,0x3F,0x60,0x3E,0x03,0x7E,0x80,0x02,0x00,0x7E,0x80,0x03,0x18,0x80,0x02,0x00
.db 0x80,0x03,0x63,0x3E,0x80,0x02,0x00,0x80,0x02,0x63,0x36,0x1C,0x80,0x02,0x00,0x63
.db 0x6B,0x7F,0x77,0x63,0x80,0x02,0x00,0x63,0x36,0x1C,0x36,0x63,0x80,0x02,0x00,0x66
.db 0x66,0x3C,0x18,0x18,0x80,0x02,0x00,0x7E,0x0C,0x18,0x30,0x7E,0x80,0x02,0x00,0x72
.db 0x25,0x25,0x27,0x25,0x00,0x80,0x00,0x00,0x60,0x50,0x60,0x50,0x60,0x80,0x02,0x00
.db 0x6E,0x80,0x02,0x84,0x64,0x80,0x02,0x00,0xC8,0xA8,0xA8,0xC8,0xAE,0x80,0x02,0x00
.db 0x6A,0x8A,0x4E,0x2A,0xCA,0x80,0x06,0x00,0x03,0x07,0x07,0x80,0x04,0x00,0x80,0x02
.db 0xFF,0x80,0x04,0x00,0xC0,0xE0,0xE0,0x07,0x07,0x03,0x00,0x00,0x03,0x07,0x07,0x80
.db 0x02,0xFF,0x00,0x00,0x80,0x05,0xFF,0x00,0x00,0xC3,0xE7,0xE7,0xE0,0xE0,0xC0,0x00
.db 0x00,0xC0,0xE0,0xE0,0x80,0x07,0x07,0x80,0x07,0xE0,0x80,0x09,0xE7,0xC3,0x00,0x00
.db 0x80,0x02,0xFF,0xE7,0xE7,0xC7,0x07,0x07,0xC7,0xE7,0xE7,0x07,0x07,0x03,0x80,0x04
.db 0x00,0x80,0x02,0xFF,0x80,0x04,0x00,0xE0,0xE0,0xC0,0x80,0x04,0x00,0xE7,0xE7,0xC7
.db 0x80,0x04,0x07,0xE7,0xE7,0xE3,0xE0,0xE0,0xE3,0xE7,0xE7,0x80,0x04,0x00,0xC3,0xE7
.db 0xE7,0xE0,0xE0,0xC0,0x00,0x00,0x80,0x02,0xFF,0xE7,0xE7,0xC3,0x00,0x00,0xC3,0xE7
.db 0xE7,0x83,0x80,0x04,0x7D,0x83,0xFF,0x83,0x80,0x04,0x01,0x83,0xFF,0x83,0x80,0x04
.db 0x01,0x83,0xFF,0x83,0x80,0x04,0x01,0x83,0xFF,0x83,0x80,0x04,0x01,0x83,0x80,0x04
.db 0xFF,0x83,0xC7,0xEF,0xFF,0xFF,0x87,0x83,0x81,0x83,0x87,0xFF,0xFF,0x0C,0x14,0x80
.db 0x02,0x64,0x14,0x0C,0x00,0x0C,0x14,0x80,0x02,0x64,0x14,0x0C,0x80,0x02,0x00,0x18
.db 0x24,0x24,0x18,0x00,0x00,0xFF,0xFF,0xE7,0xC3,0xC3,0xE7,0x80,0x03,0xFF,0xE7,0xC3
.db 0xC3,0xE7,0x80,0x02,0xFF,0x9F,0xE7,0xF9,0xFE,0xFF,0xFF,0x00,0x80,0x03,0xFF,0x7F
.db 0x9F,0xFF,0xFF,0x00,0x00,0x01,0x06,0x18,0x60,0x80,0x02,0x00,0x60,0x80,0x00,0x80
.db 0x05,0x00,0x40,0x20,0x11,0x0A,0x04,0x80,0x02,0x00,0x40,0x80,0x00,0x80,0x04,0x00
.db 0xFF,0xFB,0xF5,0xEE,0xDF,0xBF,0xFF,0x80,0x04,0x00,0x80,0x00,0x40,0x00,0x00,0xFF
.db 0x81,0xBD,0xBD,0xFD,0xFC,0xFF,0x00,0x80,0x02,0xFF,0xEF,0xEF,0x0F,0xFF,0x00,0x00
.db 0x18,0x24,0x42,0x01,0x80,0x02,0x00,0x80,0x02,0xFF,0xEF,0xDF,0x3F,0xFF,0x00,0xFF
.db 0x8F,0xF7,0xFB,0xFD,0xFE,0xFF,0x80,0x05,0x00,0xC0,0x00,0x00,0xFF,0xBF,0xDF,0xE0
.db 0x80,0x02,0xFF,0x00,0x80,0x02,0xFF,0x3F,0xDF,0xEF,0xFF,0x00,0x80,0x06,0xFF,0x00
.db 0xE7,0xE7,0xC3,0x80,0x0C,0x00,0xE0,0xE0,0xC0,0x00,0x00,0xC3,0xE7,0xE7,0xF8,0x80
.db 0x04,0xF0,0xF8,0xFF,0x00,0x3C,0x80,0x02,0x22,0x3C,0x00,0xFF,0xC0,0x80,0x04,0x80
.db 0xC0,0xFF,0x03,0x80,0x04,0x01,0x03,0xFF,0x00,0x18,0x00,0x38,0x18,0x3C,0x00,0x00
.db 0x80,0x02,0x80,0xBE,0x80,0x02,0x80,0xFF,0x80,0x00,0x88,0x88,0xBE,0x88,0x88,0x80
.db 0x00,0xFF,0x80,0x00,0x80,0x00,0xBE,0x9C,0x88,0x80,0x00,0x80,0x00,0xFF,0x80,0x00
.db 0xBE,0x88,0x80,0x00,0x88,0x9C,0x80,0x00,0xFF,0x7F,0x80,0x04,0x80,0x7F,0xFF,0xFE
.db 0x80,0x04,0x81,0xFE,0xFF,0xFF,0x80,0x03,0xAB,0x80,0x02,0xFF,0x80,0x04,0x00,0x03
.db 0x07,0x1F,0x00,0x03,0x0F,0x7F,0x80,0x03,0xFF,0x3F,0x80,0x06,0xFF,0xFC,0x80,0x06
.db 0xFF,0x00,0xC0,0xF0,0xFE,0x80,0x03,0xFF,0x80,0x04,0x00,0xC0,0xE0,0xF8,0x80,0x02
.db 0x00,0x01,0x01,0x03,0x07,0x07,0x3F,0x7F,0x80,0x0D,0xFF,0xFC,0xFE,0x80,0x05,0xFF
.db 0x80,0x02,0x00,0x80,0x00,0x80,0x00,0xC0,0xE0,0xE0,0x0F,0x80,0x02,0x1F,0x3F,0x3F
.db 0x7F,0x7F,0xF0,0x80,0x02,0xF8,0xFC,0xFC,0xFE,0xFE,0x7F,0x7F,0x80,0x05,0xFF,0xFE
.db 0xFE,0x80,0x05,0xFF,0x80,0x07,0x00,0x80,0x05,0xFF,0x7F,0x7F,0x80,0x05,0xFF,0xFE
.db 0xFE,0x7F,0x7F,0x3F,0x3F,0x80,0x02,0x1F,0x0F,0xFE,0xFE,0xFC,0xFC,0x80,0x02,0xF8
.db 0xF0,0x07,0x07,0x03,0x01,0x01,0x80,0x02,0x00,0x80,0x05,0xFF,0x7F,0x3F,0x80,0x05
.db 0xFF,0xFE,0xFC,0xE0,0xE0,0xC0,0x80,0x00,0x80,0x00,0x80,0x02,0x00,0x1F,0x07,0x03
.db 0x80,0x04,0x00,0x80,0x03,0xFF,0x7F,0x0F,0x03,0x00,0x80,0x06,0xFF,0x3F,0x80,0x06
.db 0xFF,0xFC,0x80,0x03,0xFF,0xFE,0xF0,0xC0,0x00,0xF8,0xE0,0xC0,0x80,0x14,0x00,0x80
.db 0xFF



; Project: The Alan Random Project (TARP)
; tileset color - type:G2
; Tiles range: 0 to 255
; RLE WB compressed - Original size= 2048 - Compress size= 747
TILESET_COL:
.db 0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE
.db 0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE
.db 0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE,0x80,0x06,0x2F,0xEE
.db 0x80,0x37,0x4E,0x80,0x05,0x74,0xE4,0xEE,0x80,0x06,0xF4,0xFE,0x80,0x06,0x84,0x8E
.db 0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x0F,0xED,0x80,0x0F,0xE1,0x80,0x0F
.db 0x41,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x0A,0xE1,0x80,0x02
.db 0xE0,0xE1,0xE0,0xE0,0xE1,0xE1,0xE0,0xE0,0x80,0x05,0xE1,0x80,0x04,0xE0,0xE1,0x80
.db 0x07,0xE0,0xE1,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x09,0xE1
.db 0x80,0x06,0xE0,0xE1,0x80,0x06,0xE0,0xE1,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80
.db 0x04,0xE0,0x80,0x05,0xE1,0x80,0x02,0xE0,0x80,0x03,0xE1,0xE0,0x80,0x07,0xE1,0xE0
.db 0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1
.db 0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80
.db 0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04
.db 0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1
.db 0x80,0x04,0xE0,0x80,0x02,0xE1,0xE0,0xE0,0xE1,0xE0,0xE0,0x80,0x02,0xE1,0xE0,0xE0
.db 0xE1,0x80,0x02,0xE0,0xE1,0xE1,0x80,0x04,0xE0,0x80,0x03,0xE1,0xE0,0xE1,0xE0,0x80
.db 0x03,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x03,0xE0,0xE1,0xE0,0xE1,0xE1,0x80
.db 0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02
.db 0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0
.db 0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80
.db 0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02
.db 0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0
.db 0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80
.db 0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02
.db 0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0
.db 0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80
.db 0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0xE1,0xE1
.db 0x80,0x06,0xE0,0xE1,0xE1,0x80,0x04,0xE0,0xE1,0xE1,0x80,0x06,0xE0,0xE1,0xE1,0x80
.db 0x04,0xE0,0x80,0x02,0xE1,0x80,0x04,0xE0,0xE1,0xE1,0x80,0xDF,0xED,0x80,0x0F,0xDE
.db 0x80,0x0F,0xD1,0x80,0x06,0xF4,0xE4,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80
.db 0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80
.db 0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80
.db 0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80
.db 0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80
.db 0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80
.db 0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80
.db 0x05,0x74,0xE4,0xEE,0x80,0x06,0x74,0x7E,0x80,0x05,0x74,0xE4,0xEE,0x80,0x05,0x74
.db 0xE4,0xEE,0x80,0x05,0x74,0xE4,0xEE,0x80,0x9F,0xE5,0x80,0x07,0x14,0x80,0x07,0x1C
.db 0x80,0x07,0x18,0x80,0x07,0x17,0x80,0x07,0x1F,0x80,0x07,0x17,0x80,0x07,0xE8,0x80
.db 0x07,0xFE,0x80,0x07,0x2E,0x0E,0x80,0x06,0x1E,0x80,0x07,0xEC,0x80,0x07,0xE9,0x80
.db 0x06,0xF4,0xEE,0x80,0x06,0xF4,0xE4,0x80,0x06,0x4F,0x4E,0x80,0x06,0x4F,0x4E,0x80
.db 0x06,0x4F,0xEE,0x80,0x06,0x4F,0x0E,0x80,0x06,0xF4,0xFE,0x80,0x06,0x4F,0x0E,0x80
.db 0x06,0xF4,0xFE,0x80,0x06,0xF4,0xFE,0x80,0x06,0x4F,0x4E,0x80,0x06,0xF4,0xFE,0x80
.db 0x06,0xF4,0x0E,0x80,0x06,0x4F,0x0E,0x80,0x06,0xF4,0x0E,0x80,0x06,0xF4,0x0E,0x80
.db 0x07,0xFE,0x80,0x17,0xE5,0x80,0x07,0xE4,0x80,0x06,0x84,0x80,0x10,0xE4,0x80,0x06
.db 0xF4,0xFE,0x80,0x1F,0xE4,0x05,0x80,0x04,0x0C,0x05,0xE5,0x15,0x80,0x04,0x08,0x05
.db 0xE5,0x80,0x06,0x15,0xE5,0x80,0xFE,0x61,0x61,0x80,0xFF




__endasm;
}



// set sprites data in vram
void setSprites() __naked
{
__asm

  ld   HL,#SPRITES_DATA
  ld   DE,#BASE14
  jp   unRLEWBVRAM
  

; Project: The Alan Random Project (TARP)
; SpriteSet Pattern Data - Size:16x16
; Sprite range: 0 to 7
; RLE WB compressed - Original size= 256 - Compress size= 184
SPRITES_DATA:
.db 0x80,0x06,0x00,0x01,0x01,0x80,0x0D,0x00,0x80,0x00,0x80,0x00,0x80,0x0C,0x00,0x01
.db 0x03,0x03,0x01,0x80,0x0B,0x00,0x80,0x00,0xC0,0xC0,0x80,0x00,0x80,0x0A,0x00,0x01
.db 0x03,0x07,0x07,0x03,0x01,0x80,0x09,0x00,0x80,0x00,0xC0,0xE0,0xE0,0xC0,0x80,0x00
.db 0x80,0x08,0x00,0x03,0x07,0x80,0x03,0x0F,0x07,0x03,0x80,0x07,0x00,0xC0,0xE0,0x80
.db 0x03,0xF0,0xE0,0xC0,0x80,0x06,0x00,0x01,0x07,0x0F,0x0F,0x1F,0x1F,0x0F,0x0F,0x07
.db 0x01,0x80,0x05,0x00,0x80,0x00,0xE0,0xF0,0xF0,0xF8,0xF8,0xF0,0xF0,0xE0,0x80,0x00
.db 0x80,0x04,0x00,0x03,0x0F,0x1F,0x1F,0x80,0x03,0x3F,0x1F,0x1F,0x0F,0x03,0x80,0x03
.db 0x00,0xC0,0xF0,0xF8,0xF8,0x80,0x03,0xFC,0xF8,0xF8,0xF0,0xC0,0x80,0x02,0x00,0x03
.db 0x0F,0x1F,0x3F,0x3F,0x80,0x03,0x7F,0x3F,0x3F,0x1F,0x0F,0x03,0x00,0x00,0xC0,0xF0
.db 0xF8,0xFC,0xFC,0x80,0x03,0xFE,0xFC,0xFC,0xF8,0xF0,0xC0,0x00,0x07,0x1F,0x3F,0x7F
.db 0x7F,0x80,0x05,0xFF,0x7F,0x7F,0x3F,0x1F,0x07,0xE0,0xF8,0xFC,0xFE,0xFE,0x80,0x05
.db 0xFF,0xFE,0xFE,0xFC,0xF8,0xE0,0x80,0xFF

__endasm;
}




// pantalla principal
void setMainScr() __naked
{
__asm

  ld   HL,#SCR01
  ld   DE,#BASE10
  jp   unRLEWBVRAM


; Project: The Alan Random Project (TARP)
; map size width:32 height:24
; RLE WB compressed - Original size= 768 - Compress size= 377
SCR01:
.db 0xA0,0x80,0x09,0xA1,0xA2,0x80,0x0F,0xEF,0x1A,0x1B,0x1C,0x1D,0xA7,0x73,0x6F,0x6E
.db 0x67,0x80,0x05,0x20,0xA8,0x80,0x13,0xEF,0xA7,0x20,0x54,0x45,0x4D,0x50,0x4F,0x20
.db 0x0A,0xD9,0xDA,0xA8,0x80,0x13,0xEF,0xA7,0x80,0x09,0x20,0xA8,0x80,0x13,0xEF,0xA7
.db 0xD4,0x9B,0x9C,0x92,0x81,0x8E,0x84,0x8F,0x8D,0xD7,0xA8,0x80,0x13,0xEF,0xA3,0x80
.db 0x09,0xA4,0xA6,0x80,0x13,0xEF,0xA7,0x64,0x72,0x75,0x6D,0x20,0x7D,0x20,0x0F,0x10
.db 0xBC,0xA8,0x80,0x13,0xEF,0xA7,0x80,0x09,0x20,0xA8,0x80,0x06,0xEF,0xE0,0xE1,0xE2
.db 0xE3,0xE4,0xE5,0x80,0x06,0xEF,0xA7,0x20,0x43,0x41,0x53,0x49,0x4F,0x20,0x20,0xDF
.db 0xDE,0xA8,0x80,0x05,0xEF,0xE6,0xE7,0x80,0x03,0xE8,0xE9,0xEA,0x80,0x05,0xEF,0xA7
.db 0x80,0x09,0x20,0xA8,0x80,0x05,0xEF,0xEB,0x80,0x05,0xE8,0xEC,0x80,0x05,0xEF,0xA7
.db 0xD4,0x9D,0x9E,0x92,0x81,0x8E,0x84,0x8F,0x8D,0xD7,0xA8,0x80,0x05,0xEF,0xED,0x80
.db 0x05,0xE8,0xEE,0x80,0x05,0xEF,0xA3,0x80,0x09,0xA4,0xA6,0x80,0x05,0xEF,0xF0,0x80
.db 0x05,0xE8,0xF1,0x80,0x05,0xEF,0xA7,0x74,0x6F,0x6E,0x65,0x20,0x7C,0x20,0x0F,0x11
.db 0xBC,0xA8,0x80,0x05,0xEF,0xF2,0x80,0x05,0xE8,0xF3,0x80,0x05,0xEF,0xA7,0x20,0x41
.db 0x2B,0x42,0x80,0x03,0x20,0xDF,0xDE,0xA8,0x80,0x05,0xEF,0xF4,0xF5,0x80,0x03,0xE8
.db 0xF6,0xF7,0x80,0x05,0xEF,0xA7,0x20,0x4F,0x53,0x45,0x54,0x80,0x02,0x0A,0xD9,0xDA
.db 0xA8,0x80,0x06,0xEF,0xF8,0xF9,0xFA,0xFB,0xFC,0xFD,0x80,0x06,0xEF,0xA7,0x80,0x09
.db 0x20,0xA8,0x80,0x13,0xEF,0xA7,0x20,0x45,0x4E,0x56,0x20,0xD0,0xD0,0x0A,0xD9,0xDA
.db 0xA8,0x80,0x13,0xEF,0xA7,0x20,0x53,0x50,0x45,0x45,0x44,0x20,0x0A,0xD9,0xDA,0xA8
.db 0x80,0x13,0xEF,0xA7,0x20,0x4C,0x4F,0x4F,0x50,0x80,0x02,0x20,0xDF,0xDE,0xA8,0x80
.db 0x13,0xEF,0xA7,0x80,0x09,0x20,0xA8,0x80,0x13,0xEF,0xA7,0x20,0x4F,0x43,0x54,0x41
.db 0x56,0x45,0x0A,0xD9,0xDA,0xA8,0x80,0x13,0xEF,0xA7,0x20,0x55,0x50,0x2F,0x44,0x4F
.db 0x57,0x4E,0xD9,0xDA,0xA8,0x80,0x13,0xEF,0xA7,0xD4,0x9F,0x13,0x92,0x81,0x8E,0x84
.db 0x8F,0x8D,0xD7,0xA8,0xEF,0x7F,0x80,0x0F,0xB4,0xEF,0xEF,0xAC,0x80,0x09,0xAD,0xAE
.db 0xEF,0x7E,0x80,0x0F,0xB4,0xEF,0xEF,0x80,0xFF

__endasm;
}




// cambia la paleta de colores del logo (MSX2)
void setMSX2logoPal()
{
__asm

  ld hl,#PALETTE00
  xor	a
	di
	out	(#0x99),a
	ld	a,#144
	out	(#0x99),a
	ld	bc,#0x209A
	otir
	ei
  ret
  
; Default Palette
; RB,G
PALETTE00:
.db 0x00,0x00
.db 0x00,0x00
.db 0x01,0x06
.db 0x03,0x07
.db 0x24,0x03
.db 0x27,0x03
.db 0x51,0x01
.db 0x27,0x06
.db 0x71,0x01
.db 0x73,0x03
.db 0x61,0x06
.db 0x64,0x06
.db 0x01,0x05
.db 0x65,0x02
.db 0x55,0x05
.db 0x77,0x07

__endasm;
}


// cambia la paleta de colores (MSX2)
void setMSX2Palette()
{
__asm

  ld hl,#PALETTE01
  xor	a
	di
	out	(#0x99),a
	ld	a,#144
	out	(#0x99),a
	ld	bc,#0x209A
	otir
	ei
  ret

; alanRandoms
; RB,G
PALETTE01:
.db 0x00,0x00
.db 0x00,0x00
.db 0x44,0x04
.db 0x33,0x07
.db 0x17,0x03
.db 0x33,0x03
.db 0x61,0x01
.db 0x27,0x06
.db 0x71,0x01
.db 0x73,0x03
.db 0x61,0x06
.db 0x64,0x06
.db 0x11,0x04
.db 0x65,0x02
.db 0x66,0x06
.db 0x77,0x07

__endasm;
}